name: Release

on:
  push:
    tags:
      - "v*.*.*"

jobs:
  build_and_test:
    # NOTE: Need to provide a valid ref (e.g. SHA, release tag, branch). Github is working to add
    # local reference support. (https://github.community/t/ref-head-in-reusable-workflows/203690)
    uses: cgrindel/bazel-starlib/.github/workflows/build_and_test.yml@50ea013c7fbf5b0a598afc77af28ab111bc191ea

  create_release:
    # NOTE: Need to provide a valid ref (e.g. SHA, release tag, branch). Github is working to add
    # local reference support. (https://github.community/t/ref-head-in-reusable-workflows/203690)
    uses: cgrindel/bazel-starlib/.github/workflows/create_release.yml@

  # ubuntu_build:
  #   runs-on: ubuntu-latest
  #   env:
  #     CC: clang

  #   steps:

  #   - uses: actions/checkout@v2

  #   - name: Write local.bazelrc File
  #     shell: bash
  #     run: |
  #       cat >local.bazelrc <<EOF
  #       common --config=ci
  #       EOF

  #   - name: Output the Bazel Info
  #     shell: bash
  #     run: |
  #       bazelisk info

  #   - name: Generate Release Notes
  #     shell: bash
  #     run: |
  #       bazelisk run //tools:generate_release_notes -- \
  #         --output release_notes.md \
  #         "${GITHUB_REF_NAME}"

  #   - name: Create Release
  #     uses: softprops/action-gh-release@v1
  #     with:
  #       name: Release ${{ github.ref_name }}
  #       body_path: release_notes.md
